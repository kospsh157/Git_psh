<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8">
    </head>
<body>

<!-- axios CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script type="text/javascript">
const div1 = document.createElement('div');
const div2 = document.createElement('div');
const div3 = document.createElement('div');
const div4 = document.createElement('div');

const span1 = document.createElement('span');
const span2 = document.createElement('span');
const span3 = document.createElement('span');
const span4 = document.createElement('span');

span1.textContent = '스판1';
span2.textContent = '여기 위에는 테스트한 결과물 여기 -------------------------- 아래는 통신 테스트 페이지';
span3.textContent = '스판3';
span4.textContent = '스판4';

div1.appendChild(span1);
div2.appendChild(span1);
// 이렇게 되면  div1에 span1이 있다가 div2로 이동된다. 
// 하나의 문서에 노드는 중복될 수 없기 때문이다. 

document.body.appendChild(div1);
document.body.appendChild(div2);
document.body.appendChild(div3);
document.body.appendChild(div4);
// div을 어펜드시키면 세로로 칸으로 쌓인다.(가로열을 div 하나가 다 먹는다.)
// 반면에 span은 가로줄로 계속 붙는다. 

document.body.appendChild(document.createElement('div').appendChild(span2));

const form = document.createElement('form');
const input = document.createElement('input');
// input 태그의 id 지정해주고
input.id = 'name';
form.appendChild(input);

const button = document.createElement('button');
button.type = 'submit';
button.textContent = '등록';
form.appendChild(button);

// 만든 form 요소를 바디에 단다. 
// document.body 는 html body전체를 의미한다. 둘 중에 하나라도 생략하면 브라우저에서 오류가 난다.
document.body.appendChild(form);

// 서버에서 받아 온 데이터 뿌려줄 리스트 요소 생성
const list = document.createElement('list');
document.body.appendChild(list);

// getName() 함수를 만들어 초기 페이지에서 서버에서 데이터를 받아서 프론트로 뿌려주자.
async function getName(){
    try{
        const res = await axios.get('/getName');
        console.log('다음 아래 확인');
        console.log(res.data);
        //JSON으로 바뀌어서 왔을 테니깐 다시 js 객체로 변환
        const obj = await JSON.parse(res.data);
        
        // 서버에서 받아온 names 객체 확인 
        conssole.log(obj);
        
        // 리스트 요소 초기화 
        list.innerHTML = '';

        Object.keys(obj).map((key) => {
            const span = document.createElement('span');
            const editButton = document.createElement('button');
            const deleteButton = document.createElement('button');
            editButton.textContent = '수정';
            deleteButton.textContent = '삭제';
            
            span.textContent = obj[key];

            list.appendChild(span).appendChild(editButton).appendChild(deleteButton);
        })
    }catch(err){
        console.error(err);
    }
}


// getElementsByTagName()은 반환이 배열이다. 그리고 addEventListener를 지원하지 않는다. 

// from 태그에 리스너 달기
// 콜백 함수 안에 비동기 코드가 있고, 동기식으로 해야하므로 async를 붙여줘야 한다.
form.addEventListener('submit', async (e) => {
    console.log('등록 버튼 실행');
    e.preventDefault();
    const name = e.target.name.value; 

    try{
        // JSON문자여로 바꿔서 보내야 하지만 간단한 문자열이므로, 그냥 보낸다
        console.log('다음 이름 서버로 전송', name);
        await axios.post('/postName/', {name});
       
    }catch(err){
        console.log("뭐야여기야?");
        console.error(err);
    }

    getName();
})


</script>
</body>
</html>